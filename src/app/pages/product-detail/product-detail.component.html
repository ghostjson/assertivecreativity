<app-header></app-header>
<div class="container mb-5">
  <div class="row justify-content-between align-items-center">
    <div class="product-img col-md-5">
      <div id="product-indicator" class="carousel slide card border" data-ride="carousel">
        <div class="card-body">
          <ol class="carousel-indicators">
            <!-- <li data-target="#product-indicator" data-slide-to="0" class="active"></li> -->
            <!-- <li data-target="#product-indicator" data-slide-to="1"></li> -->
            <!-- <li data-target="#product-indicator" data-slide-to="2"></li> -->
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100" src="{{product.image}}" alt="{{ product.name }}" />
            </div>
            <!-- <div class="carousel-item">
            <img
              class="d-block w-100"
              src="assets/images/demo-product-images/p2.jpg"
              alt="First slide"
            />
          </div> -->
          </div>
          <a class="carousel-control-prev" href="#product-indicator" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#product-indicator" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="content pt-5">
        <h3>{{product.name}}</h3>
        <h4 class="product-price">${{priceTotal}}/piece</h4>
        <div class="params card border">
          <div class="card-body">
            <p class="category">Category: <span class="highlight">Shirt</span></p>
            <p class="availibility">
              Availibility:
              <span *ngIf="product.stock > 0; else elseBlock" class="highlight">In Stock</span>
              <ng-template #elseBlock>
                <span class="highlight text-danger">Out Of Stock</span>
              </ng-template>
            </p>
            <h4 class="mt-3">Description</h4>
            <p class="description">
              {{product.description}}
            </p>
          </div>
        </div>
        <div class="options mt-5">
          <div class="quatity">
            <div class="row">
              <div class="col-md-4">
                <div class="input-group input-group-sm">
                  <div class="input-group-prepend">
                    <span class="input-group-text ">Quantity</span>
                  </div>
                  <input class="form-control" type="number" value="100" />
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="product-controls mt-3">
          <!-- <div class="col"> -->
          <a href="#" class="btn btn-primary mr-2">
            ADD TO CART
          </a>
          <a href="#negotiate-form" class="btn btn-success mr-2">
            NEGOTIATE
          </a>
          <!-- </div> -->
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-7">
          <!-- Customization form starts -->
          <form
            class="customization-form mt-3 card border"
            [formGroup]="orderFeaturesForm"
            id="negotiate-form"
          >
            <div
              formArrayName="features"
              >
              <div
                *ngFor="let featureForm of features().controls;
                        let featureInd = index"
                class="card-body"
              >
                <!-- render the base options of the form -->
                <div [formGroupName]="featureInd">
                  <!-- add color option -->
                  <div *ngIf="product.features[featureInd].type === 'color'" class="form-group pick-color">
                    <app-product-options-color
                      [formGroup]="featureForm"
                      [feature]="product.features[featureInd]"
                      [featureInd]="featureInd"
                    >
                    </app-product-options-color>
                    <button
                      *ngIf="product.features[featureInd].chainedInputs.length > 0"
                      [disabled]="!featureForm.valid"
                      (click)="addChainedInputs(featureInd)"
                      class="btn btn-success btn--more-options"
                      type="button"
                    >
                      Show Options
                    </button>
                  </div>

                  <!-- add radio option -->
                  <div *ngIf="product.features[featureInd].type === 'radioBtn'" class="form-group radio-btn">
                    <app-product-options-radio-btn
                      [formGroup]="featureForm"
                      [feature]="product.features[featureInd]"
                      [featureInd]="featureInd"
                    ></app-product-options-radio-btn>
                    <button
                      *ngIf="product.features[featureInd].chainedInputs.length > 0"
                      [disabled]="!featureForm.valid"
                      (click)="addChainedInputs(featureInd)"
                      class="btn btn-success btn--more-options"
                      type="button"
                    >
                      Show Options
                    </button>
                  </div>

                  <!-- add dropdown selection -->
                  <div *ngIf="product.features[featureInd].type === 'dropdown'" class="form-group radio-btn">
                    <app-product-options-dropdown
                      [formGroup]="featureForm"
                      [feature]="product.features[featureInd]"
                      [featureInd]="featureInd"
                    ></app-product-options-dropdown>
                    <button
                      *ngIf="product.features[featureInd].chainedInputs.length > 0"
                      [disabled]="!featureForm.valid"
                      (click)="addChainedInputs(featureInd)"
                      class="btn btn-success btn--more-options"
                      type="button"
                    >
                      Show Options
                    </button>
                  </div>
                </div>


                <!-- render the chained inputs on activity in the form -->
                <div [formGroupName]="featureInd">
                  <div formArrayName="chainedInputs">
                    <div *ngFor="let chainedInput of chainedInputs(featureInd).controls; let chainedInd = index">
                      {{chainedInd}}
                      <!-- adding chained color selector -->
                      <div
                        *ngIf="product.features[featureInd].chainedInputs[chainedInd].type === 'color'"
                        [formGroupName]="chainedInd"
                      >
                        <app-product-options-color
                          [formGroup]="chainedInput"
                          [feature]="product.features[featureInd].chainedInputs[chainedInd]"
                          [featureInd]="featureInd"
                          [chainedInd]="chainedInd"
                        >
                        </app-product-options-color>
                      </div>

                      <!-- adding chained dropdown selector -->
                      <div
                        *ngIf="product.features[featureInd].chainedInputs[chainedInd].type === 'dropdown'"
                        [formGroupName]="chainedInd"
                      >
                        <app-product-options-dropdown
                          [formGroup]="chainedInput"
                          [feature]="product.features[featureInd].chainedInputs[chainedInd]"
                          [featureInd]="featureInd"

                        >
                        </app-product-options-dropdown>
                      </div>

                      <!-- adding chained radio button selector -->
                      <div
                        *ngIf="product.features[featureInd].chainedInputs[chainedInd].type === 'radioBtn'"
                        [formGroupName]="chainedInd"
                      >
                        <app-product-options-radio-btn
                          [formGroup]="chainedInput"
                          [feature]="product.features[featureInd].chainedInputs[chainedInd]"
                          [featureInd]="featureInd"
                          [chainedInd]="chainedInd"
                        >
                        </app-product-options-radio-btn>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="card-body">
              Total Price: <strong>{{priceTotal}}</strong>
            </div>
            <div class="card-footer">
              <button class="btn btn-success card-footer__btn" type="button" (click)="updatePrice()">
                Update Price
              </button>
              <button
                class="btn btn-primary card-footer__btn"
                type="submit"
                (click)="onSubmit()">
                Order
              </button>
            </div>
          </form>
          <!-- Customization form ends -->
        </div>

        <div class="col-5">
          <div class="row d-flex flex-column justify-content-center align-items-center">
            <div class="col-9 card border">
              <div class="card-body">
                <img class="product-img--form object--contain" src="{{product.image}}" alt="product image">
                <hr>
                <p>
                  Price: {{priceTotal}}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
