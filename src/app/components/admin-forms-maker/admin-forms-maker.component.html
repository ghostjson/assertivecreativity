<div class="p-grid admin-forms-maker-component">
  <div class="p-col-12 p-md-4 p-lg-3">
    <aside class="questions-overview-list-wrapper">
      <p-card>
        <p-header>
          <h3>Form Overview</h3>
        </p-header>
        <div
          class="questions-overview-list"
          cdkDropList
          [cdkDropListData]="formGroup.value.questions"
          [cdkDropListConnectedTo]="dropNewQuestion"
          (cdkDropListDropped)="handleDragSort($event)"
        >
          <div
            *ngFor="
              let question of formGroup.value.questions;
              index as questionInd;
              trackBy: trackById
            "
            class="questions-overview-list-item p-d-flex p-jc-between p-mt-2"
            pTooltip="Drag to reorder"
            cdkDrag
          >
            <div class="questions-overview-list-item__label">
              <span class="p-text-bold"> {{ questionInd + 1 }}. </span>
              {{ question.label }}
              <div class="custom-placeholder" *cdkDragPlaceholder></div>
            </div>
            <div class="questions-overview-list-item__tools">
              <button
                aria-label="delete question"
                role="button"
                class="p-button-text p-button-danger"
                icon="pi pi-times"
                (click)="removeQuestion(questionInd)"
                pButton
              ></button>
            </div>
          </div>
        </div>
      </p-card>
    </aside>
  </div>

  <div #formsPartContainer class="form-maker p-col-12 p-md-8 p-lg-9">
    <p-card class="form-maker-card">
      <form [formGroup]="formGroup" class="order-form-maker">
        <h3>
          {{ formGroup.value.title }}
        </h3>

        <div class="p-fluid p-mt-3">
          <div class="p-field p-input-filled">
            <label for="mail-form-title-{{ formGroup.value.id }}">
              Enter title of the form
            </label>
            <input
              type="text"
              formControlName="title"
              id="mail-form-title-{{ formGroup.value.id }}"
              placeholder="Eg: Pick a color for the product ?"
              pInputText
            />
          </div>
        </div>

        <ng-container formArrayName="questions">
          <div class="question-maker-list p-mt-5">
            <div
              *ngFor="
                let question of questions().controls;
                index as questionIndex;
                trackBy: trackFormGroupById
              "
              class="question-maker-list__item"
            >
              <app-admin-forms-question-maker
                [questionIndex]="questionIndex"
                [question]="question"
                (childQuestionActive)="catchActiveChildQuestion($event)"
                (removeQuestion)="removeQuestion(questionIndex)"
              ></app-admin-forms-question-maker>
            </div>
          </div>

          <div class="p-fluid p-mt-6">
            <div
              #dropNewQuestion="cdkDropList"
              cdkDropList
              (cdkDropListDropped)="addDroppedForm($event)"
              class="drop-region p-d-flex p-flex-column p-ai-center p-jc-center"
            >
              <i class="add-icon pi pi-plus"></i>
              <i class="droppable-icon pi pi-check"></i>
              <div class="placeholder-text">Drop Question Here</div>
              <div class="droppable-text">Drop To Add</div>
            </div>
            <button
              type="button"
              label="Add New Question"
              icon="pi pi-plus"
              iconPos="right"
              class="p-button-success p-button-lg p-shadow-2"
              (click)="addQuestion()"
              pButton
            ></button>
          </div>
        </ng-container>
      </form>
    </p-card>
    <p-dialog
      header="Add Child Questions"
      class="child-question-dialog"
      position="right"
      [(visible)]="dialogs.childQuestion"
      [resizable]="false"
      [draggable]="false"
      [closable]="false"
      [dismissableMask]="true"
      [closeOnEscape]="true"
      [style]="{
        width: formsPartWidth
      }"
    >
      <div class="p-mt-5">
        <app-admin-forms-question-maker
          *ngIf="activeChildQuestion"
          [questionIndex]="activeChildQuestion.questionIndex"
          [question]="activeChildQuestion.question"
          (removeQuestion)="removeActiveChildQuestion($event)"
        ></app-admin-forms-question-maker>
      </div>
      <p-footer>
        <button
          type="button"
          label="Done"
          class="p-button-success p-shadow-2"
          (click)="toggleChildQuestionDialog()"
          pButton
        ></button>
      </p-footer>
    </p-dialog>
  </div>
</div>
